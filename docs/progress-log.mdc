# Journal OnpointDoc

Ce journal liste les jalons validés et les prochaines étapes à suivre pour OnpointDoc.

## 2025-11-15
- ✅ Initialisation du projet Next.js 15 + TypeScript + Tailwind + ShadCN UI.
- ✅ Mise en place de l’architecture `src/app`, `src/components`, `src/services`, `src/lib`, `src/ui`.
- ✅ Formulaire de création de ticket (React Hook Form + Zod) connecté à Supabase (server actions).
- ✅ Pages Dashboard, Tickets, Activités, Tâches avec layout AppShell, sidebar fixe, top bar sticky.
- ✅ Mode clair/sombre (next-themes), toggle Sun/Moon, prise en charge du thème dans tous les composants.
- ✅ Règles Cursor : PRD, structure, UX flows, base de données, workflows N8N, tech stack, style guide, architecture frontend, code qualité.
- ✅ Fichier orchestrateur `master.mdc` pour gouvernance globale des règles.
- ✅ Configuration Git locale + `.gitignore`, premier commit, remote GitHub `stew-nocode/onpointdoc` (branche `main`).
- ✅ Résolution warning d’hydratation (balise `<html suppressHydrationWarning>`).
- ✅ **Branchement produits/modules Supabase** : Création service `src/services/products/index.ts` pour récupérer produits et modules depuis Supabase. Modification `TicketForm` pour accepter données en props. Alignement des enums (canaux, priorités, statuts) avec les types Supabase. Migration DB ajoutant `duration_minutes` et `customer_context` à la table `tickets`.
- ✅ **Automatisations N8N/JIRA** : Service `transferTicketToJira()` pour transférer Assistance → JIRA via webhook N8N. Page détail ticket (`/gestion/tickets/[id]`) avec bouton "Transférer". Route API `/api/webhooks/jira` pour synchronisation retour. Documentation complète dans `docs/workflows/` avec diagrammes Mermaid et guide de configuration N8N.

## 2025-11-16
- ✅ Auth & Sécurité
  - Page `/auth/login` (Supabase Email+Password), middleware global (`middleware.ts`) + garde client dans `AppShell`.
  - Bouton “Se déconnecter” (TopBar).
  - Sidebar avec icônes (Lucide) et correction des clés React.
- ✅ Tickets & Flux
  - Formulaire de création en modal (`CreateTicketDialog`) avec upload de pièces jointes (bucket `ticket-attachments`, table `ticket_attachments` + RLS).
  - Champs additionnels: contact (profil client), produit → module → sous‑module → fonctionnalité, durée.
  - Filtrage par type/statut et par affectations modules (table `user_module_assignments`, RLS ajustée).
  - Lien “Contacts” sous “Tickets” listant tous les utilisateurs (internes + externes) + modal “Nouveau contact” (rôle `client`).
- ✅ Configuration (B2B)
  - Compagnies: index + “Nouvelle compagnie” (modal), édition/visualisation/suppression, point focal (profil), pays (`countries`) et secteurs (`sectors` + `company_sector_link`).
  - Modules: index + créer/éditer/voir/supprimer (modals).
  - Sous‑modules: index + créer/éditer/voir/supprimer (modals).
  - Fonctionnalités: index + créer/éditer/voir/supprimer (modals).
  - Utilisateurs (internes uniquement): index, création (Auth+profil+affectations), édition (profil+affectations), suppression.
  - UI : remplacement des cases “Actif” par un toggle moderne (`ui/toggle`).
- ✅ Base de données & RLS
  - `countries` + `companies.country_id`, `companies.focal_user_id`.
  - `sectors` + `company_sector_link` (RLS: lecture tout le monde / insert‑delete admin).
  - `user_module_assigments` RLS corrigée (admin/manager peuvent insérer/supprimer; visibilité pour l’utilisateur et les managers/admins).
- ✅ Intégrations & Outils
  - API `/api/admin/users/create` (service_role) pour créer user Auth + profil + affectations.
  - Routines Git régulières (branche `feat/ticket-attachments-upload`).

## À faire
- ⏳ Workflows N8N/JIRA selon `docs/workflows/n8n-setup-guide.md` et webhooks de synchro retour.
- ⏳ Édition/Suppression côté “Contacts” (si souhaité).
- ⏳ Recherche/filtrage/pagination avancée sur listes (Users/Companies/Modules/…).
- ⏳ Tests unitaires/e2e sur services sensibles (auth, RLS, creation flows).
